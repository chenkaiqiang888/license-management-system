(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[808],{5219:function(e,s,t){Promise.resolve().then(t.bind(t,7255))},7255:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return i}});var r=t(7437),a=t(2265),l=t(1344);function n(e){let{onClose:s,onSuccess:t}=e,[l,n]=(0,a.useState)({productId:"",startTime:"",endTime:"",maxActivations:1,note:""}),[i,d]=(0,a.useState)(!1),o=async e=>{if(e.preventDefault(),!l.startTime||!l.endTime){alert("请填写开始时间和结束时间");return}if(new Date(l.startTime)>=new Date(l.endTime)){alert("结束时间必须晚于开始时间");return}try{d(!0);let e=await fetch("/api/licenses/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:l.productId||null,startTime:new Date(l.startTime).toISOString(),endTime:new Date(l.endTime).toISOString(),maxActivations:l.maxActivations,note:l.note||null})}),s=await e.json();s.success?(alert("授权创建成功"),t()):alert(s.error||"创建失败")}catch(e){console.error("创建授权失败:",e),alert("创建失败")}finally{d(!1)}},c=e=>{let{name:s,value:t}=e.target;n(e=>({...e,[s]:"maxActivations"===s?parseInt(t)||1:t}))};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm overflow-y-auto h-full w-full z-50 flex items-center justify-center p-4",children:(0,r.jsx)("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 w-full max-w-md",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"创建授权"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"生成新的软件授权码"})]}),(0,r.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-lg hover:bg-gray-100",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsxs)("form",{onSubmit:o,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"产品ID（可选）"}),(0,r.jsx)("input",{type:"text",name:"productId",value:l.productId,onChange:c,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:"输入产品ID"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"开始时间 *"}),(0,r.jsx)("input",{type:"datetime-local",name:"startTime",value:l.startTime,onChange:c,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"结束时间 *"}),(0,r.jsx)("input",{type:"datetime-local",name:"endTime",value:l.endTime,onChange:c,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",required:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"最大激活数"}),(0,r.jsx)("input",{type:"number",name:"maxActivations",value:l.maxActivations,onChange:c,min:"1",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"备注"}),(0,r.jsx)("textarea",{name:"note",value:l.note,onChange:c,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors resize-none",rows:3,placeholder:"授权备注信息（可选）"})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,r.jsx)("button",{type:"button",onClick:s,className:"px-6 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors",disabled:i,children:"取消"}),(0,r.jsx)("button",{type:"submit",className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-medium rounded-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:transform-none",disabled:i,children:i?(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"创建中..."]}):"创建授权"})]})]})]})})})}function i(){let[e,s]=(0,a.useState)([]),[t,i]=(0,a.useState)(!0),[d,o]=(0,a.useState)(!1),[c,x]=(0,a.useState)(1),[m,h]=(0,a.useState)(1),[u,p]=(0,a.useState)(""),[g,b]=(0,a.useState)(""),[f,j]=(0,a.useState)({total:0,active:0,revoked:0,expired:0});(0,a.useEffect)(()=>{v()},[c,u,g]);let v=async()=>{try{i(!0);let e=new URLSearchParams({page:c.toString(),limit:"20"});u&&e.append("search",u),g&&e.append("status",g);let t=await fetch("/api/licenses?".concat(e)),r=await t.json();if(r.success){s(r.data.licenses),h(r.data.pagination.pages);let e=r.data.licenses;j({total:e.length,active:e.filter(e=>"active"===e.status).length,revoked:e.filter(e=>"revoked"===e.status).length,expired:e.filter(e=>"expired"===e.status).length})}}catch(e){console.error("获取授权列表失败:",e)}finally{i(!1)}},y=async e=>{if(confirm("确定要撤销此授权吗？"))try{let s=await fetch("/api/licenses/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({licenseId:e,reason:"管理员撤销"})}),t=await s.json();t.success?(alert("授权已撤销"),v()):alert(t.error||"撤销失败")}catch(e){console.error("撤销授权失败:",e),alert("撤销失败")}},N=async e=>{let s=prompt("请输入新的结束时间 (YYYY-MM-DD):");if(s)try{let t=await fetch("/api/licenses/renew",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({licenseId:e,newEndTime:new Date(s).toISOString(),reason:"管理员续期"})}),r=await t.json();r.success?(alert("授权续期成功"),v()):alert(r.error||"续期失败")}catch(e){console.error("续期授权失败:",e),alert("续期失败")}},w=e=>{let s={active:{class:"bg-green-100 text-green-800 border-green-200",icon:"✓",text:"活跃"},revoked:{class:"bg-red-100 text-red-800 border-red-200",icon:"✕",text:"已撤销"},expired:{class:"bg-yellow-100 text-yellow-800 border-yellow-200",icon:"⏰",text:"已过期"}},t=s[e]||s.active;return(0,r.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(t.class),children:[(0,r.jsx)("span",{className:"mr-1",children:t.icon}),t.text]})},k=e=>{let s=new Date;return Math.ceil((new Date(e).getTime()-s.getTime())/864e5)};return(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-100",children:[(0,r.jsx)(l.Z,{}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"授权管理"}),(0,r.jsx)("p",{className:"text-gray-600",children:"管理软件授权码，监控使用状态"})]}),(0,r.jsx)("div",{className:"mt-4 sm:mt-0",children:(0,r.jsxs)("button",{onClick:()=>o(!0),className:"inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200",children:[(0,r.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"创建授权"]})})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:(0,r.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"总授权数"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.total})]})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"p-3 bg-green-100 rounded-lg",children:(0,r.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"活跃授权"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.active})]})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"p-3 bg-red-100 rounded-lg",children:(0,r.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"已撤销"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.revoked})]})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"p-3 bg-yellow-100 rounded-lg",children:(0,r.jsx)("svg",{className:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"已过期"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:f.expired})]})]})})]}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-lg border border-white/20 mb-8",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,r.jsx)("input",{type:"text",placeholder:"搜索授权码或备注...",value:u,onChange:e=>p(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),(0,r.jsx)("div",{className:"sm:w-48",children:(0,r.jsxs)("select",{value:g,onChange:e=>b(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"",children:"全部状态"}),(0,r.jsx)("option",{value:"active",children:"活跃"}),(0,r.jsx)("option",{value:"revoked",children:"已撤销"}),(0,r.jsx)("option",{value:"expired",children:"已过期"})]})})]})}),(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 overflow-hidden",children:t?(0,r.jsx)("div",{className:"p-8",children:(0,r.jsx)("div",{className:"animate-pulse space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,r.jsx)("div",{className:"h-16 bg-gray-200 rounded"},s))})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-gray-50/80",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"授权码"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"产品"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"有效期"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"激活数"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"备注"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-200",children:e.map(e=>{var s;let t=k(e.end_time);return(0,r.jsxs)("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"font-mono text-sm font-medium text-gray-900",children:e.license_key}),(0,r.jsx)("button",{className:"ml-2 text-gray-400 hover:text-gray-600",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"text-sm text-gray-900",children:(null===(s=e.products)||void 0===s?void 0:s.name)||"-"})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"text-sm text-gray-900",children:[(0,r.jsx)("div",{children:new Date(e.start_time).toLocaleDateString()}),(0,r.jsxs)("div",{className:"text-gray-500",children:["至 ",new Date(e.end_time).toLocaleDateString()]}),"active"===e.status&&t>0&&(0,r.jsxs)("div",{className:"text-xs mt-1 ".concat(t<=7?"text-red-600":t<=30?"text-yellow-600":"text-green-600"),children:["剩余 ",t," 天"]})]})}),(0,r.jsx)("td",{className:"px-6 py-4",children:w(e.status)}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"text-sm text-gray-900",children:e.max_activations})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:e.note||"-"})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"flex space-x-2",children:"active"===e.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>N(e.id),className:"text-blue-600 hover:text-blue-800 text-sm font-medium px-3 py-1 rounded-md hover:bg-blue-50 transition-colors",children:"续期"}),(0,r.jsx)("button",{onClick:()=>y(e.id),className:"text-red-600 hover:text-red-800 text-sm font-medium px-3 py-1 rounded-md hover:bg-red-50 transition-colors",children:"撤销"})]})})})]},e.id)})})]})}),m>1&&(0,r.jsxs)("div",{className:"bg-gray-50/80 px-6 py-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-700",children:["第 ",c," 页，共 ",m," 页"]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>x(Math.max(1,c-1)),disabled:1===c,className:"px-4 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"上一页"}),(0,r.jsx)("button",{onClick:()=>x(Math.min(m,c+1)),disabled:c===m,className:"px-4 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"下一页"})]})]})]})})]}),d&&(0,r.jsx)(n,{onClose:()=>o(!1),onSuccess:()=>{o(!1),v()}})]})}},1344:function(e,s,t){"use strict";t.d(s,{Z:function(){return i}});var r=t(7437),a=t(7648),l=t(9376);let n=[{name:"仪表盘",href:"/"},{name:"授权管理",href:"/licenses"},{name:"激活记录",href:"/activations"},{name:"操作日志",href:"/logs"}];function i(){let e=(0,l.usePathname)();return(0,r.jsx)("nav",{className:"bg-white shadow-sm border-b",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsx)("div",{className:"flex justify-between h-16",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0 flex items-center",children:(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"授权管理系统"})}),(0,r.jsx)("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:n.map(s=>{let t=e===s.href;return(0,r.jsx)(a.default,{href:s.href,className:"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ".concat(t?"border-blue-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:s.name},s.name)})})]})})})})}}},function(e){e.O(0,[448,971,117,744],function(){return e(e.s=5219)}),_N_E=e.O()}]);