(()=>{var e={};e.id=186,e.ids=[186],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2087:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>h,originalPathname:()=>x,pages:()=>o,routeModule:()=>m,tree:()=>c}),s(1360),s(1506),s(5866);var a=s(3191),n=s(8716),r=s(7922),i=s.n(r),l=s(5231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let c=["",{children:["activations",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,1360)),"C:\\Users\\Ad\\Desktop\\授权后台\\app\\activations\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,1506)),"C:\\Users\\Ad\\Desktop\\授权后台\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["C:\\Users\\Ad\\Desktop\\授权后台\\app\\activations\\page.tsx"],x="/activations/page",h={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/activations/page",pathname:"/activations",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7772:(e,t,s)=>{Promise.resolve().then(s.bind(s,6208))},7402:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},6903:()=>{},6208:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var a=s(326),n=s(7577),r=s(7553);function i(){let[e,t]=(0,n.useState)([]),[s,i]=(0,n.useState)(!0),[l,d]=(0,n.useState)(1),[c,o]=(0,n.useState)(1),[x,h]=(0,n.useState)(""),[m,u]=(0,n.useState)(""),p=async()=>{try{i(!0);let e=new URLSearchParams({page:l.toString(),limit:"20"});x&&e.append("license_id",x),m&&e.append("status",m);let s=await fetch(`/api/activations?${e}`),a=await s.json();a.success&&(t(a.data.activations),o(a.data.pagination.pages))}catch(e){console.error("获取激活记录失败:",e)}finally{i(!1)}},v=async(e,t)=>{if(confirm("确定要解绑此设备吗？"))try{let s=await fetch("/api/activations/unbind",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({licenseId:e,deviceId:t,reason:"管理员解绑"})}),a=await s.json();a.success?(alert("设备解绑成功"),p()):alert(a.error||"解绑失败")}catch(e){console.error("解绑设备失败:",e),alert("解绑失败")}},j=e=>e.unbound_at?a.jsx("span",{className:"status-badge status-revoked",children:"已解绑"}):a.jsx("span",{className:"status-badge status-active",children:"活跃"});return(0,a.jsxs)("div",{children:[a.jsx(r.Z,{}),a.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"激活记录"}),(0,a.jsxs)("div",{className:"mb-6 flex gap-4",children:[a.jsx("input",{type:"text",placeholder:"搜索授权ID...",value:x,onChange:e=>h(e.target.value),className:"input flex-1"}),(0,a.jsxs)("select",{value:m,onChange:e=>u(e.target.value),className:"input w-40",children:[a.jsx("option",{value:"",children:"全部状态"}),a.jsx("option",{value:"active",children:"活跃"}),a.jsx("option",{value:"unbound",children:"已解绑"})]})]}),(0,a.jsxs)("div",{className:"card",children:[s?a.jsx("div",{className:"animate-pulse",children:a.jsx("div",{className:"h-64 bg-gray-200 rounded"})}):a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"table",children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"设备ID"}),a.jsx("th",{children:"授权码"}),a.jsx("th",{children:"设备信息"}),a.jsx("th",{children:"激活时间"}),a.jsx("th",{children:"解绑时间"}),a.jsx("th",{children:"状态"}),a.jsx("th",{children:"操作"})]})}),a.jsx("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"font-mono text-sm",children:e.device_id}),a.jsx("td",{className:"font-mono text-sm",children:e.licenses?.license_key||"-"}),a.jsx("td",{className:"max-w-xs truncate",children:e.device_info||"-"}),a.jsx("td",{children:new Date(e.activated_at).toLocaleString()}),a.jsx("td",{children:e.unbound_at?new Date(e.unbound_at).toLocaleString():"-"}),a.jsx("td",{children:j(e)}),a.jsx("td",{children:!e.unbound_at&&a.jsx("button",{onClick:()=>v(e.license_id,e.device_id),className:"text-red-600 hover:text-red-800 text-sm",children:"解绑"})})]},e.id))})]})}),c>1&&a.jsx("div",{className:"flex justify-center mt-6",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>d(Math.max(1,l-1)),disabled:1===l,className:"btn btn-secondary disabled:opacity-50",children:"上一页"}),(0,a.jsxs)("span",{className:"px-4 py-2 text-sm text-gray-700",children:["第 ",l," 页，共 ",c," 页"]}),a.jsx("button",{onClick:()=>d(Math.min(c,l+1)),disabled:l===c,className:"btn btn-secondary disabled:opacity-50",children:"下一页"})]})})]})]})})]})}},7553:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var a=s(326),n=s(434),r=s(5047);let i=[{name:"仪表盘",href:"/"},{name:"授权管理",href:"/licenses"},{name:"激活记录",href:"/activations"},{name:"操作日志",href:"/logs"}];function l(){let e=(0,r.usePathname)();return a.jsx("nav",{className:"bg-white shadow-sm border-b",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsx("div",{className:"flex justify-between h-16",children:(0,a.jsxs)("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0 flex items-center",children:a.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"授权管理系统"})}),a.jsx("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:i.map(t=>{let s=e===t.href;return a.jsx(n.default,{href:t.href,className:`inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ${s?"border-blue-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"}`,children:t.name},t.name)})})]})})})})}},1360:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(8570).createProxy)(String.raw`C:\Users\Ad\Desktop\授权后台\app\activations\page.tsx#default`)},1506:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l,metadata:()=>i});var a=s(9510),n=s(7366),r=s.n(n);s(7272);let i={title:"授权管理系统",description:"软件授权码管理系统"};function l({children:e}){return a.jsx("html",{lang:"zh-CN",children:a.jsx("body",{className:r().className,children:a.jsx("div",{className:"min-h-screen bg-gray-50",children:e})})})}},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,82,496],()=>s(2087));module.exports=a})();