"use strict";(()=>{var e={};e.id=622,e.ids=[622],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},8597:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>I,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{GET:()=>u});var i=r(9303),o=r(8716),a=r(670),n=r(7070),p=r(5662);async function u(e){try{let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),s=parseInt(t.get("limit")||"20"),i=t.get("status"),o=t.get("search"),a=t.get("product_id"),u=p.O.from("licenses").select(`
        *,
        products (
          id,
          name
        )
      `,{count:"exact"});i&&(u=u.eq("status",i)),a&&(u=u.eq("product_id",a)),o&&(u=u.or(`license_key.ilike.%${o}%,note.ilike.%${o}%`));let c=(r-1)*s,{data:d,error:l,count:h}=await u.order("created_at",{ascending:!1}).range(c,c+s-1);if(l)return console.error("查询授权列表失败:",l),n.NextResponse.json({error:"查询失败"},{status:500});return n.NextResponse.json({success:!0,data:{licenses:d||[],pagination:{page:r,limit:s,total:h||0,pages:Math.ceil((h||0)/s)}}})}catch(e){return console.error("查询授权列表异常:",e),n.NextResponse.json({error:"服务器内部错误"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/licenses/route",pathname:"/api/licenses",filename:"route",bundlePath:"app/api/licenses/route"},resolvedPagePath:"C:\\Users\\Ad\\Desktop\\授权后台\\app\\api\\licenses\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:h}=c,x="/api/licenses/route";function I(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:l})}},5662:(e,t,r)=>{r.d(t,{O:()=>a});var s=r(9498);let i=process.env.SUPABASE_URL||"https://qjukpzpvbxajiawdlcxo.supabase.co",o=process.env.SUPABASE_SERVICE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqdWtwenB2Ynhhamlhd2RsY3hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4ODA2MjksImV4cCI6MjA3MzQ1NjYyOX0.aJMbToTrs2jypBVM_b4LsR2dgAIxXquS1huLViUgu0Y",a=(0,s.eI)(i,o,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,338],()=>r(8597));module.exports=s})();