"use strict";(()=>{var e={};e.id=366,e.ids=[366],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},4904:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>v,staticGenerationAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{GET:()=>p});var i=r(9303),a=r(8716),n=r(670),o=r(7070),u=r(5662);async function p(e){try{let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),s=parseInt(t.get("limit")||"20"),i=t.get("license_id"),a=t.get("device_id"),n=t.get("status"),p=u.O.from("activations").select(`
        *,
        licenses (
          id,
          license_key,
          status,
          end_time
        )
      `,{count:"exact"});i&&(p=p.eq("license_id",i)),a&&(p=p.eq("device_id",a)),"active"===n?p=p.is("unbound_at",null):"unbound"===n&&(p=p.not("unbound_at","is",null));let c=(r-1)*s,{data:d,error:l,count:v}=await p.order("activated_at",{ascending:!1}).range(c,c+s-1);if(l)return console.error("查询激活记录失败:",l),o.NextResponse.json({error:"查询失败"},{status:500});return o.NextResponse.json({success:!0,data:{activations:d||[],pagination:{page:r,limit:s,total:v||0,pages:Math.ceil((v||0)/s)}}})}catch(e){return console.error("查询激活记录异常:",e),o.NextResponse.json({error:"服务器内部错误"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/activations/route",pathname:"/api/activations",filename:"route",bundlePath:"app/api/activations/route"},resolvedPagePath:"C:\\Users\\Ad\\Desktop\\授权后台\\app\\api\\activations\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:v}=c,h="/api/activations/route";function x(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:l})}},5662:(e,t,r)=>{r.d(t,{O:()=>n});var s=r(9498);let i=process.env.SUPABASE_URL||"https://qjukpzpvbxajiawdlcxo.supabase.co",a=process.env.SUPABASE_SERVICE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqdWtwenB2Ynhhamlhd2RsY3hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4ODA2MjksImV4cCI6MjA3MzQ1NjYyOX0.aJMbToTrs2jypBVM_b4LsR2dgAIxXquS1huLViUgu0Y",n=(0,s.eI)(i,a,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,338],()=>r(4904));module.exports=s})();